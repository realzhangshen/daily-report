{#
  Daily Briefing Template (Chinese)

  Jinja2 template for rendering a synthesized daily briefing as HTML.

  Template Variables:
    title: Report title string
    generated_at: Timestamp string
    total: Number of articles (int)
    briefing: BriefingResult object with:
      - executive_summary: str
      - top_stories: list of dicts with "title", "analysis"
      - sections: list of BriefingSection with "theme", "description"
      - quick_mentions: list of dicts with "title", "description"
      - raw_text: str (fallback)
    articles_by_title: dict mapping title -> Article (for URL lookup)
#}
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ title }}</title>
  <style>
    :root {
      --bg: #f6f5f2;
      --card: #ffffff;
      --text: #1a1a1a;
      --muted: #666;
      --accent: #0f766e;
      --accent-light: #f1f9f8;
      --border: #e4e4e4;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, "SF Pro Text", "PingFang SC", "Noto Sans SC", "Helvetica Neue", sans-serif;
      background: radial-gradient(circle at top, #ffffff 0%, #f6f5f2 40%, #efece6 100%);
      color: var(--text);
      line-height: 1.8;
    }
    header {
      padding: 2.5rem 1.5rem 1.5rem;
      text-align: center;
      border-bottom: 1px solid var(--border);
    }
    header h1 {
      font-size: 2rem;
      font-weight: 700;
      letter-spacing: 0.02em;
    }
    header .meta {
      margin-top: 0.5rem;
      color: var(--muted);
      font-size: 0.95rem;
    }
    .container {
      max-width: 860px;
      margin: 0 auto;
      padding: 1.5rem;
    }

    /* Executive Summary */
    .executive-summary {
      margin: 2rem 0;
      padding: 1.25rem 1.5rem;
      background: var(--accent-light);
      border-left: 4px solid var(--accent);
      border-radius: 0 8px 8px 0;
      font-size: 1.05rem;
      line-height: 1.9;
      white-space: pre-wrap;
    }

    /* Section Cards */
    .section-card {
      margin: 2rem 0;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.04);
    }
    .section-card h2 {
      color: var(--accent);
      font-size: 1.4rem;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px dashed var(--border);
    }

    /* Top Stories */
    .story {
      padding: 1rem 0;
      border-bottom: 1px dashed var(--border);
    }
    .story:last-child {
      border-bottom: none;
      padding-bottom: 0;
    }
    .story h3 {
      font-size: 1.15rem;
      font-weight: 600;
      margin-bottom: 0.4rem;
    }
    .story h3 a {
      color: var(--text);
      text-decoration: none;
      border-bottom: 1px solid transparent;
      transition: border-color 0.2s, color 0.2s;
    }
    .story h3 a:hover {
      color: var(--accent);
      border-bottom-color: var(--accent);
    }
    .story .analysis {
      color: var(--text);
      line-height: 1.8;
      white-space: pre-wrap;
    }

    /* Themed Sections */
    .theme-item {
      padding: 1rem 0;
      border-bottom: 1px dashed var(--border);
    }
    .theme-item:last-child {
      border-bottom: none;
      padding-bottom: 0;
    }
    .theme-item h3 {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--accent);
      margin-bottom: 0.3rem;
    }
    .theme-item p {
      line-height: 1.8;
      white-space: pre-wrap;
    }

    /* Quick Mentions */
    .quick-list {
      list-style: none;
      padding: 0;
    }
    .quick-list li {
      padding: 0.6rem 0;
      border-bottom: 1px solid var(--border);
      font-size: 0.95rem;
      line-height: 1.7;
    }
    .quick-list li:last-child {
      border-bottom: none;
    }
    .quick-list .quick-title {
      font-weight: 600;
    }
    .quick-list .quick-desc {
      color: var(--muted);
      margin-left: 0.25rem;
    }

    /* Fallback */
    .fallback {
      margin: 2rem 0;
      padding: 1.25rem;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 8px;
      white-space: pre-wrap;
      font-size: 0.95rem;
      line-height: 1.7;
      overflow-x: auto;
    }

    /* Responsive */
    @media (max-width: 600px) {
      header h1 { font-size: 1.5rem; }
      .container { padding: 1rem; }
      .section-card { padding: 1rem; }
      .executive-summary { padding: 1rem; }
    }
  </style>
</head>
<body>
  <header>
    <h1>{{ title }}</h1>
    <div class="meta">{{ total }} 篇文章 · 生成于 {{ generated_at }}</div>
  </header>

  <div class="container">
    {% if briefing.executive_summary or briefing.top_stories %}

    {# Executive Summary #}
    {% if briefing.executive_summary %}
    <div class="executive-summary">{{ briefing.executive_summary }}</div>
    {% endif %}

    {# Top Stories #}
    {% if briefing.top_stories %}
    <div class="section-card">
      <h2>重点报道</h2>
      {% for story in briefing.top_stories %}
      <div class="story">
        <h3>
          {% set matched_article = articles_by_title.get(story.title) %}
          {% if matched_article %}
          <a href="{{ matched_article.url }}" target="_blank" rel="noopener">{{ story.title }}</a>
          {% else %}
          {{ story.title }}
          {% endif %}
        </h3>
        {% if story.analysis %}
        <div class="analysis">{{ story.analysis }}</div>
        {% endif %}
      </div>
      {% endfor %}
    </div>
    {% endif %}

    {# Themed Sections #}
    {% if briefing.sections %}
    {% for section in briefing.sections %}
    <div class="section-card">
      <h2>{{ section.theme }}</h2>
      <div class="theme-item">
        <p>{{ section.description }}</p>
      </div>
    </div>
    {% endfor %}
    {% endif %}

    {# Quick Mentions #}
    {% if briefing.quick_mentions %}
    <div class="section-card">
      <h2>速览</h2>
      <ul class="quick-list">
        {% for mention in briefing.quick_mentions %}
        <li>
          <span class="quick-title">{{ mention.title }}</span>
          {% if mention.description %}
          <span class="quick-desc">— {{ mention.description }}</span>
          {% endif %}
        </li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}

    {% else %}
    {# Fallback: show raw_text if parsing failed #}
    {% if briefing.raw_text %}
    <div class="fallback">{{ briefing.raw_text }}</div>
    {% endif %}
    {% endif %}
  </div>
</body>
</html>
